{"version":3,"sources":["dataProvider.js"],"names":["_namespace","weatherProvider","WeatherProvider","_config","api_key","api_url","interval","data_check_interval_seconds","location","daycount","subscribers","check","console","log","$","get","buildQuery","data","localStorage","setItem","JSON","stringify","forEach","subscriber","setLocation","parse","getItem","e","name","pos","lat","lon","removeItem","terminate","_location","__checkInterval","setInterval","setTimeout","_what","push","indexOf","splice","clearInterval","GL_CONFIG"],"mappings":"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","file":"../providers/dataProvider.js","sourcesContent":["_namespace = \"PROEXPERT.DATASTORAGE\";\n\n_namespace.weatherProvider = function() {\n     class WeatherProvider {\n        constructor(_config) {\n            this.api_key = _config.api_key;\n            this.api_url = _config.api_url;\n            this.interval = _config.data_check_interval_seconds;\n            this.location = null;\n\n           \n\n            this.daycount = 7;\n            this.subscribers = [];\n            this.check = () => {\n                console.log(\"check\")\n                if(! this. location) {\n                    return;\n                }\n                $.get( this.api_url+this.buildQuery(), ( data ) => {\n                    console.log(\"got data\", data);\n                    localStorage.setItem(\"_lastLocation\", JSON.stringify( this.location));\n                    localStorage.setItem(\"_lastWeather\", JSON.stringify(data));\n                    this.subscribers.forEach((subscriber)=>subscriber(data));\n                }, \"json\" );\n            };\n\n             try {\n              this.setLocation( JSON.parse(localStorage.getItem(\"_lastLocation\"))) ;\n            } catch(e) {\n\n            }\n        }\n\n        buildQuery() {\n            //api.openweathermap.org/data/2.5/weather?q=London,uk\n            //api.openweathermap.org/data/2.5/weather?lat=35&lon=139\n            if(! this.location) {\n                return null;\n            }\n            if(this.location.name) {\n                return `?q=${this.location.name}&APPID=${this.api_key}&cnt=${this.daycount}`;\n            }\n            return `?lat=${this.location.pos.lat}&lon=${this.location.pos.lon}&APPID=${this.api_key}&cnt=${this.daycount}`;\n        }\n\n        deleteLocation() {\n            localStorage.removeItem(\"_lastLocation\");\n            localStorage.removeItem(\"_lastWeather\");\n            this.location = null;\n            this.terminate();\n        }\n\n        setLocation(_location) {\n            if(JSON.stringify(this.location) !== JSON.stringify(_location)) {\n                           localStorage.removeItem(\"_lastLocation\");\n                           localStorage.removeItem(\"_lastWeather\");\n            }\n\n            this.location = _location;\n            this.terminate();\n            this.__checkInterval = setInterval(this.check, this.interval*1000);\n            setTimeout(this.check, 0);\n        }\n\n        lastSaved() {\n            try {\n              return JSON.parse(localStorage.getItem(\"_lastWeather\"));\n            } catch(e) {\n                return null;\n            }\n        };\n\n        subscribe(_what) {\n            this.subscribers.push(_what);\n        }\n\n        unsubscribe(_what) {\n            const pos = this.subscribers.indexOf(_what);\n            if(pos != -1) {\n                this.subscribers.splice(pos,1);\n            }\n\n        }\n        terminate() {\n            clearInterval(this.__checkInterval);\n        }\n\n\n    }\n    \n    return new  WeatherProvider(GL_CONFIG);\n}()"]}